<%=

require 'compact_index'

versions =
  gem
  .gems
  .collect do |y|
    spec = spec_for(y.name, y.number, y.platform)
    deps =
      spec
      .dependencies
      .sort_by(&:name)
      .collect do |dependency|
        CompactIndex::Dependency.new(
          dependency.name,
          dependency.requirement.to_s,
          nil #Digest::SHA256.file('%s/gems/%s.gem' % [settings.public_folder, dependency.gemfile_name]).hexdigest
          )
      end

    CompactIndex::GemVersion.new(
      y.version.to_s,
      y.platform,
      Digest::SHA256.file('%s/gems/%s.gem' % [settings.public_folder, y.gemfile_name]).hexdigest,
      nil, # CompactIndex.info([y.version.to_s]), ???
      deps,
      spec.required_ruby_version.to_s,
      nil #spec.rubygems_version.to_s
      )
  end
CompactIndex.info(versions).to_s

%>
