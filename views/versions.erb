created_at: <%= Time.now.utc.iso8601 %>
---
<%=
  require 'compact_index'

  cg =
     gems
    .sort_by(&:name)
    .group_by(&:name)
    .collect do |name, gem_versions|
      CompactIndex::Gem.new(
        name,
        gem_versions.collect{ |y|
          # Is this what I'm supposed to checksum? No?
          CompactIndex::GemVersion.new(
            y.version.to_s,
            y.platform,
            '', # Digest::MD5.file('%s/gems/%s.gem' % [settings.public_folder, y.gemfile_name]).hexdigest,
            ''
            )
          }
        )
    end

  # versions_path = '%s/versions.list' % [ settings.public_folder ]
  CompactIndex::VersionsFile
    .new(File::NULL) # (versions_path)
    .contents(cg) #, calculate_info_checksums: true)
    .to_s 
%>

